/*
*********************************************************************************************************
*
*                                     				 APPLICATION
*
* Filename      : NTC10K3950.c
* Version       : V1.00
*********************************************************************************************************
*/

/*
*********************************************************************************************************
*                                             INCLUDE FILES
*********************************************************************************************************
*/

#include "NTC10K3950.h"
#include "includes.h"

/*
*********************************************************************************************************
*                                         LOCAL GLOBAL VARIABLES
*********************************************************************************************************
*/

//unsigned int TemperatureTable[181] =   //10K B=3950
//{
//65530, //-50
//65530, //-49
//65530, //-48
//65530, //-47
//62867, //-46
//58253, //-45
//54014, //-44
//50117, //-43
//46530, //-42
//43223, //-41
//40186, //-40
//37381, //-39
//34793, //-38
//32404, //-37
//30197, //-36
//28157, //-35
//26271, //-34
//24525, //-33
//22908, //-32
//21409, //-31
//20020,//-30
//18731,//-29
//17535,//-28
//16424,//-27
//15392,//-26
//14432,//-25
//13538,//-24
//12707,//-23
//11933,//-22
//11211,//-21
//10538,//-20
//9910,//-19
//9325,//-18
//8778,//-17
//8267,//-16
//7789,//-15
//7343,//-14
//6925,//-13
//6534,//-12
//6167,//-11
//5824,//-10
//5503,//-9
//5201,//-8
//4918,//-7
//4652,//-6
//4402,//-5
//4168,//-4
//3947,//-3
//3740,//-2
//3545,//-1
//3362,//0
//3189,//1
//3027,//2
//2873,//3
//2728,//4
//2592,//5
//2464,//6
//2342,//7
//2228,//8
//2119,//9
//2017,//10
//1921,//11
//1829,//12
//1743,//13
//1661,//14
//1584,//15
//1510,//16
//14352,//17
//13705,//18
//13090,//19
//12507,//20
//11953,//21
//11427,//22
//10927,//23
//10452,//24
//10000,//25
//956,//26
//915,//27
//876,//28
//839,//29
//804,//30
//770,//31
//738,//32
//707,//33
//678,//34
//650,//35
//624,//36
//599,//37
//575,//38
//552,//39
//530,//40
//509,//41
//489,//42
//470,//43
//452,//44
//435,//45
//418,//46
//402,//47
//387,//48
//372,//49
//359,//50
//345,//51
//333,//52
//320,//53
//309,//54
//298,//55
//287,//56
//277,//57
//267,//58
//258,//59
//249,//60
//240,//61
//232,//62
//224,//63
//216,//64
//209,//65
//201,//66
//195,//67
//188,//68
//182,//69
//176,//70
//170,//71
//165,//72
//159,//73
//154,//74
//149,//75
//144,//76
//140,//77
//135,//78
//131,//79
//127,//80
//123,//81
//119,//82
//116,//83
//112,//84
//109,//85
//105,//86
//102,//87
//99,//88
//96,//89
//93,//90
//91,//91
//88,//92
//85,//93
//83,//94
//80,//95
//78 ,//96
//76 ,//97
//74 ,//98
//72 ,//99
//70 ,//100
//68 ,//101
//66 ,//102
//64 ,//103
//62 ,//104
//60 ,//105
//59 ,//106
//57 ,//107
//56 ,//108
//54 ,//109
//53 ,//110
//52 ,//111
//50 ,//112
//49 ,//113
//48 ,//114
//46 ,//115
//45 ,//116
//44 ,//117
//43 ,//118
//42 ,//119
//41 ,//120
//40 ,//121
//39 ,//122
//38 ,//123
//37 ,//124
//36 //125
//};

unsigned int TemperatureTable[176] =   //10K B=3950
{
712066,//-50 
661926,//-49 
615656,//-48
572934,//-47 
533466,//-46 
496983,//-45
463240,//-44
432015,//-43
403104,//-42
376320,//-41
351495,//-40
328472,//-39
307110,//-38
287279,//-37
268859,//-36
251741,//-35
235826,//-34
221021,//-33
207242,//-32
194412,//-31
182460,//-30
171320,//-29
160932,//-28
151241,//-27
142196,//-26
133750,//-25
125859,//-24
118485,//-23
111589,//-22
105139,//-21
99102,//-20
93450,//-19
88156,//-18
83195,//-17
78544,//-16
74183,//-15
70091,//-14
66250,//-13
62643,//-12
59255,//-11
56071,//-10
53078,//-9
50263,//-8
47614,//-7
45121,//-6
42774,//-5
40563,//-4
38480,//-3
36517,//-2
34665,//-1
32919,//0
31270,//1
29715,//2
28246 ,//3
26858 ,//4
25547 ,//5
24307 ,//6
23135 ,//7
22026 ,//8
20977 ,//9
19987 ,//10
19044 ,//11
18154 ,//12
17310 ,//13
16510 ,//14
15752 ,//15
15034 ,//16
14352 ,//17
13705 ,//18
13090 ,//19
12507 ,//20
11953 ,//21
11427 ,//22
10927 ,//23
10452 ,//24
10000 ,//25
9570 ,//26
9161 ,//27
8771 ,//28
8401 ,//29
8048 ,//30
7712 ,//31
7391 ,//32
7086 ,//33
6795 ,//34
6518 ,//35
6254 ,//36
6001 ,//37
5761 ,//38
5531 ,//39
5311 ,//40
5102 ,//41
4902 ,//42
4710 ,//43
4528 ,//44
4353 ,//45
4186 ,//46
4026 ,//47
3874 ,//48
3728 ,//49
3588 ,//50
3454 ,//51
3326 ,//52
3203 ,//53
3085 ,//54
2973 ,//55
2865 ,//56
2761 ,//57
2662 ,//58
2567 ,//59
2476 ,//60
2388 ,//61
2304 ,//62
2223 ,//63
2146 ,//64
2072 ,//65
2000 ,//66
1932 ,//67
1866 ,//68
1803 ,//69
1742 ,//70
1684 ,//71
1627 ,//72
1573 ,//73
1521 ,//74
1471 ,//75
1423 ,//76
1377 ,//77
1332 ,//78
1289 ,//79
1248 ,//80
1208 ,//81
1170 ,//82
1133 ,//83
1097 ,//84
1063 ,//85
1030 ,//86
998 ,//87
968 ,//88
938 ,//89
909 ,//90
882 ,//91
855 ,//92
829 ,//93
805 ,//94
781 ,//95
758 ,//96
735 ,//97
714 ,//98
693 ,//99
673 ,//100
653 ,//101
635 ,//102
616 ,//103
599 ,//104
582 ,//105
565 ,//106
550 ,//107
534 ,//108
519 ,//109
505 ,//110
491 ,//111
478 ,//112
465 ,//113
452 ,//114
440 ,//115
428 ,//116
416 ,//117
405 ,//118
395 ,//119
384 ,//120
374 ,//121
364 ,//122
355 ,//123
345 ,//124
337,//125
};




/*
*********************************************************************************************************
*                                              SERVICES
*********************************************************************************************************
*/

int8_t get_temp(uint16_t *gpiovol,s16* tempArr)
{

    u32 NTCres;
    uint16_t temp_v=0;
    int8_t i=0;
		uint16_t VREG2 = gpiovol[5];

    for (i = 0; i < TEMP_NUM; ++i)
    { 
        temp_v = gpiovol[i];
        //µçÑ¹¶ÁÈ¡¹ÊÕÏ
        if((temp_v>(VREG2-50))||(temp_v<30)) 
        {
            return -1;
        } 
        NTCres = (u32)((temp_v*R22)/(VREG2-temp_v));
        tempArr[i] = resistor_to_temp(NTCres);          
     }
      
    return 0; 
}


s16 resistor_to_temp(unsigned int resistor) 
{
  	u8 n = 176;
  	u8 i = 0;
  	s16 temp = 0;  	
  	if(resistor <= TemperatureTable[n-1])
  	{ 
				temp = MAX_TEMP;
  	    return temp;
  	}  	
  	else if(resistor >= TemperatureTable[0])
  	{
				temp = MIN_TEMP;
  	    return temp;
  	}
		else
		{
				for(i = 0;i < n;i++)
				{
						if(TemperatureTable[i] == resistor)
						{
								temp = (MIN_TEMP + i*10);
								return temp;
						}
						else
						{
								if(TemperatureTable[i] > resistor)
								{
										continue;
								}
								else
								{
										temp = (s16)(MIN_TEMP + i*10 - (s16)((resistor - TemperatureTable[i])*10/(TemperatureTable[i - 1] - TemperatureTable[i])));
										return temp;
								}
						}
				}
		}
		return temp;
}
